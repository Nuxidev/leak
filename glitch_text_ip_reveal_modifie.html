<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>...</title>
  <!-- Nouvelle police (Google Fonts) -->
  <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#000;
      --fg:#fff;
      --fade-in: 900ms;
      --fade-out: 900ms;
      --hold: 2200ms;
      --initial-delay: 3000ms;
    }

    html,body{ height:100%; }

    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      display:grid;
      place-items:center;
      overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Chakra Petch", monospace;
    }

    .stage{
      position:relative;
      width:100%;
      height:100%;
      display:grid;
      place-items:center;
      pointer-events:none;
    }

    .message{
      position:relative;
      font-family: "Chakra Petch", system-ui, monospace;
      /* Taille plus petite */
      font-size: clamp(18px, 4.2vw, 54px);
      line-height:1.05;
      text-align:center;
      letter-spacing: 0.5px;
      opacity:0;
      filter: blur(3px);
      transform: translateY(10px) scale(0.99);
      transition:
        opacity var(--fade-in) ease,
        filter var(--fade-in) ease,
        transform var(--fade-in) ease;
      animation: drift 18s ease-in-out infinite alternate;
    }

    .message.visible{
      opacity:1;
      filter: blur(0px);
      transform: translateY(0px) scale(1);
    }

    .message::before,
    .message::after{
      content: attr(data-text);
      position:absolute;
      inset:0;
      mix-blend-mode:screen;
      opacity:.45;
      pointer-events:none;
    }
    .message::before{
      text-shadow: -2px 0 #0ff;
      animation: glitch1 6s infinite linear alternate-reverse;
    }
    .message::after{
      text-shadow: 2px 0 #f0f;
      animation: glitch2 7s infinite linear alternate-reverse;
    }

    @keyframes glitch1{
      0%{ transform: translate(0,0) skewX(0deg); }
      20%{ transform: translate(-1px,-1px) skewX(2deg); }
      40%{ transform: translate(1px,1px) skewX(-2deg); }
      60%{ transform: translate(-2px,0) skewX(3deg); }
      80%{ transform: translate(1px,-1px) skewX(-1deg); }
      100%{ transform: translate(0,0) skewX(0deg); }
    }
    @keyframes glitch2{
      0%{ transform: translate(0,0) skewY(0deg); }
      25%{ transform: translate(1px,-1px) skewY(2deg); }
      50%{ transform: translate(-1px,1px) skewY(-2deg); }
      75%{ transform: translate(2px,0) skewY(1deg); }
      100%{ transform: translate(0,0) skewY(0deg); }
    }

    @keyframes drift{
      0%{ transform: translateY(0px); }
      100%{ transform: translateY(-12px); }
    }

    .message.hiding{
      opacity:0;
      filter: blur(3px);
      transform: translateY(-10px) scale(0.995);
      transition:
        opacity var(--fade-out) ease,
        filter var(--fade-out) ease,
        transform var(--fade-out) ease;
    }

    @media (prefers-reduced-motion: reduce){
      .message, .message::before, .message::after{ animation: none !important; }
      .message{ transition: opacity .3s ease; }
    }
  </style>
</head>
<body>
  <div class="stage">
    <div id="msg" class="message" aria-live="polite" aria-atomic="true" data-text=""></div>
  </div>

  <script>
    async function getPublicIP(){
      try{
        const res = await fetch('https://api.ipify.org?format=json');
        const data = await res.json();
        return data.ip;
      }catch(e){
        return 'inconnue';
      }
    }

    const baseMessages = [
       "Ton IP a été leak.",
       "{IP}",
    ];

    const INITIAL_DELAY = 1000;
    const FADE_IN = 700;
    const HOLD = 2000;
    const FADE_OUT = 900;

    const el = document.getElementById('msg');

    function setText(t){
      el.setAttribute('data-text', t);
      el.textContent = t;
    }

    function show(t){
      setText(t);
      el.classList.remove('hiding');
      void el.offsetWidth; // reflow
      el.classList.add('visible');
    }

    function hide(){
      el.classList.remove('visible');
      void el.offsetWidth; // reflow
      el.classList.add('hiding');
    }

    function filledMessages(ip){
      return baseMessages.map(m => m.replace('{IP}', ip));
    }

    function wait(ms){ return new Promise(r => setTimeout(r, ms)); }

    async function run(){
      await wait(INITIAL_DELAY);

      const ip = await getPublicIP();
      let messages = filledMessages(ip);

      let i = 0;
      while(true){
        const t = messages[i % messages.length];
        show(t);
        await wait(FADE_IN + HOLD);
        hide();
        await wait(FADE_OUT);
        i++;
      }
    }

    run();
  </script>
</body>
</html>
